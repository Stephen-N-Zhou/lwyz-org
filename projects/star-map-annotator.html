<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Star Map Annotator ‚Äî LWYZ Projects</title>
  <meta name="description" content="Annotate constellations and generate bilingual (EN/‰∏≠Êñá) captions for social posts. Part of LWYZ projects." />
  <meta property="og:title" content="Star Map Annotator ‚Äî LWYZ" />
  <meta property="og:description" content="Annotate constellations and generate bilingual captions for social posts." />
  <meta property="og:type" content="article" />
  <meta property="og:url" content="https://lwyz.org/projects/star-map-annotator.html" />
  <meta property="og:image" content="/assets/og-image.jpg" />
  <link rel="icon" href="/assets/favicon.ico" />
  <style>
    :root {
      --bg: #0b1020; --bg-soft:#0f1530; --text:#e8ecf1; --muted:#9fb0c3; --brand:#7aa2ff; --card:#111833; --border:#1d2647; --ok:#35d07f;
    }
    .light { --bg:#f7f9fc; --bg-soft:#fff; --text:#121722; --muted:#5a6b82; --brand:#315efb; --card:#fff; --border:#e7ecf5; }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen,Ubuntu,Cantarell,"Helvetica Neue",Arial;line-height:1.6}
    a{color:#9bd5ff}
    header{position:sticky;top:0;z-index:50;background:color-mix(in oklab,var(--bg),transparent 20%);backdrop-filter:saturate(120%) blur(8px);border-bottom:1px solid var(--border)}
    .container{max-width:1050px;margin:0 auto;padding:0 20px}
    .nav{display:flex;align-items:center;justify-content:space-between;height:62px}
    .brand{font-weight:800}
    .btn{display:inline-flex;gap:8px;align-items:center;padding:10px 14px;border-radius:12px;border:1px solid var(--border);background:var(--card);color:var(--text)}
    .btn.primary{background:linear-gradient(160deg,var(--brand),#a9c1ff);border:none;color:#fff}
    main{padding:40px 0}
    h1{margin:0 0 8px;font-size:clamp(1.8rem,2vw+1.5rem,3rem)}
    .lead{color:var(--muted)}
    .grid{display:grid;grid-template-columns:repeat(12,1fr);gap:18px}
    .col-8{grid-column:span 8}
    .col-4{grid-column:span 4}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:16px}
    section{padding:36px 0;border-top:1px dashed var(--border)}
    pre{background:var(--bg-soft);border:1px solid var(--border);padding:14px;border-radius:12px;overflow:auto}
    code{font-family:ui-monospace,SFMono-Regular,Menlo,Consolas,"Liberation Mono",monospace}
    .gallery{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
    .gallery img{width:100%;height:180px;object-fit:cover;border-radius:12px;border:1px solid var(--border)}
    .small{font-size:.9rem;color:var(--muted)}
    footer{padding:36px 0;border-top:1px solid var(--border);color:var(--muted)}
    @media(max-width:900px){.grid{grid-template-columns:repeat(6,1fr)}.col-8{grid-column:span 6}.col-4{grid-column:span 6}.gallery{grid-template-columns:repeat(2,1fr)}}
  </style>
</head>
<body>
  <header>
    <div class="container nav">
      <a class="brand" href="/">LWYZ</a>
      <nav>
        <a class="btn" href="/index.html#projects">‚Üê Back to Projects</a>
        <button id="modeBtn" class="btn" title="Toggle theme">üåô</button>
      </nav>
    </div>
  </header>

  <main class="container">
    <h1>Star Map Annotator</h1>
    <p class="lead">Python ‚Ä¢ Imaging ‚Ä¢ Astronomy ‚Äî Annotate constellations and auto‚Äëgenerate bilingual (EN/‰∏≠Êñá) captions for social posts.</p>

    <div class="grid" style="margin-top:18px">
      <div class="col-8 card">
        <h2 style="margin-top:0">Overview</h2>
        <p>This tool helps you mark constellations on night-sky photos, then produce ready-to-post bilingual captions with hashtags. It‚Äôs designed for simple weekend astrophotography as well as kid-friendly sky learning.</p>
        <ul>
          <li>Detect & place constellation labels from a star list (CSV/JSON).</li>
          <li>Draw smooth polylines for constellation asterisms.</li>
          <li>Export annotated image (PNG/JPEG) and caption text.</li>
        </ul>
      </div>
      <aside class="col-4 card">
        <h3 style="margin-top:0">Project Facts</h3>
        <ul style="margin:0 0 0 18px">
          <li>Status: <strong>v0.2</strong></li>
          <li>Language: Python 3.10+</li>
          <li>Libs: Pillow, NumPy, SciPy (KDTree), pandas (optional)</li>
          <li>License: MIT</li>
        </ul>
        <div style="margin-top:10px">
          <a class="btn primary" href="#download">Download</a>
        </div>
      </aside>
    </div>

    <section id="demo">
      <h2>Demo</h2>
      <div class="gallery" aria-label="Annotated examples">
        <img src="/assets/star-map/demo1.jpg" alt="Orion annotated" />
        <img src="/assets/star-map/demo2.jpg" alt="Winter hexagon annotated" />
        <img src="/assets/star-map/demo3.jpg" alt="Cygnus annotated" />
      </div>
      <p class="small">Place your own images at <code>/assets/star-map/</code> to update these thumbnails.</p>
    </section>

    <section id="how-it-works">
      <h2>How it works</h2>
      <ol>
        <li><strong>Plate approximation:</strong> With a known focal length & crop, approximate the mapping from RA/Dec ‚Üí image (x,y). For casual use, you can place reference points manually.</li>
        <li><strong>Match stars:</strong> Using a reference star catalog (bright stars) and a KDTree to snap labels to nearest detected stars.</li>
        <li><strong>Render:</strong> Draw polylines (constellation lines) and text labels with a subtle outer glow for night readability.</li>
      </ol>

<pre><code># Minimal snippet: draw a labeled point with Pillow
from PIL import Image, ImageDraw, ImageFont
im = Image.open("input.jpg").convert("RGB")
draw = ImageDraw.Draw(im)
xy = (820, 460)
draw.ellipse((xy[0]-3, xy[1]-3, xy[0]+3, xy[1]+3), fill=(255,255,255))
draw.text((xy[0]+8, xy[1]-8), "Vega / ÁªáÂ•≥Êòü", fill=(220,235,255))
im.save("annotated.jpg", quality=95)
</code></pre>

      <p class="small">Tip: to get nice line glow, draw the same polyline 2‚Äì3 times with decreasing width and increasing opacity.</p>
    </section>

    <section id="captions">
      <h2>Bilingual caption generator</h2>
      <div class="card">
        <p>Pick a preset and tweak; copy to clipboard for Â∞èÁ∫¢‰π¶/Instagram:</p>
        <div class="grid">
          <div class="col-8">
            <label class="small">Preset</label>
            <select id="preset" class="btn" style="width:100%">
              <option value="orion">Orion / ÁåéÊà∑Â∫ß</option>
              <option value="winter-hex">Winter Hexagon / ÂÜ¨Â≠£Â§ßÂÖ≠ËæπÂΩ¢</option>
              <option value="cygnus">Cygnus / Â§©ÈπÖÂ∫ß</option>
            </select>
            <label class="small" style="display:block;margin-top:10px">Caption</label>
            <textarea id="caption" style="width:100%;min-height:140px;background:var(--bg-soft);border:1px solid var(--border);color:var(--text);border-radius:12px;padding:12px"></textarea>
            <div style="margin-top:10px;display:flex;gap:10px">
              <button class="btn primary" id="copyBtn">Copy</button>
              <button class="btn" id="randomBtn">Shuffle hashtags</button>
            </div>
          </div>
          <div class="col-4">
            <div class="card" style="height:100%">
              <h3 style="margin-top:0">Hashtag pool</h3>
              <p class="small">Edit in JS if you want to customize.</p>
              <ul class="small" id="tags"></ul>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="download">
      <h2>Download & Run</h2>
      <div class="card">
        <ol>
          <li><strong>Clone</strong>: <code>git clone https://github.com/stephen-n-zhou/star-map-annotator</code> (or add this as a subfolder in your site repo)</li>
          <li><strong>Install</strong>: <code>pip install pillow numpy scipy pandas</code></li>
          <li><strong>Run</strong>: <code>python annotate.py --input input.jpg --catalog bright_stars.csv --out annotated.jpg</code></li>
        </ol>
        <p class="small">If you want a browser-based version later, we can add a canvas tool with JSON catalogs.</p>
      </div>
    </section>

    <section id="roadmap">
      <h2>Roadmap</h2>
      <ul>
        <li>JS web demo with drag‚Äëdrop image and manual 2‚Äëpoint calibration</li>
        <li>Batch annotate & export with templates</li>
        <li>Optional star databases (Hipparcos/Tycho) with magnitude filtering</li>
      </ul>
    </section>
  </main>

  <footer>
    <div class="container" style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
      <div>¬© <span id="year"></span> LWYZ</div>
      <div><a href="/privacy.html">Privacy</a> ‚Ä¢ <a href="/terms.html">Terms</a></div>
    </div>
  </footer>

  <script>
    // Theme toggle
    (function(){
      const saved = localStorage.getItem('theme');
      if(saved==='light') document.body.classList.add('light');
      const btn=document.getElementById('modeBtn');
      if(btn) btn.addEventListener('click',()=>{
        document.body.classList.toggle('light');
        localStorage.setItem('theme',document.body.classList.contains('light')?'light':'dark');
        btn.textContent=document.body.classList.contains('light')?'üåû':'üåô';
      });
      if(btn) btn.textContent=document.body.classList.contains('light')?'üåû':'üåô';
      document.getElementById('year').textContent = new Date().getFullYear();
    })();

    // Simple bilingual caption generator
    const TAGS = ["#ÊòüÁ©∫ÊëÑÂΩ±","#Â§©Êñá","#Constellations","#Astrophotography","#NightSky","#MilkyWay","#Â≠¶‰π†‰∏éËÆ∞ÂΩï","#KidsAndScience"]; 
    const PRESETS = {
      'orion': {
        en: "Orion rising over the horizon tonight. The belt stars lined up perfectly ‚Äî a good window between clouds!",
        zh: "‰ªäÊôöÁöÑÁåéÊà∑Â∫ß‰ªéÂú∞Âπ≥Á∫øÂçáËµ∑„ÄÇ‰∏âÊòüÊéíÊàê‰∏ÄÁ∫øÔºåÂàöÂ•ΩÂú®‰∫ëÈöô‰πãÈó¥Èú≤Èù¢„ÄÇ",
        extra: "Shot on a 24mm lens; gentle curves bump in post."
      },
      'winter-hex': {
        en: "The Winter Hexagon almost filled the frame ‚Äî six bright stars that define the winter sky.",
        zh: "ÂÜ¨Â≠£Â§ßÂÖ≠ËæπÂΩ¢Âá†‰πéÈì∫Êª°ÁîªÈù¢‚Äî‚ÄîÊûÑÊàêÂÜ¨Â≠£Â§úÁ©∫ÁöÑÂÖ≠È¢ó‰∫ÆÊòü„ÄÇ",
        extra: "Kids helped spot Capella and Sirius first!"
      },
      'cygnus': {
        en: "Cygnus gliding through the Milky Way. The star clouds were faint but clear to the eye.",
        zh: "Â§©ÈπÖÂ∫ßÊé†ËøáÈì∂Ê≤≥„ÄÇÊòü‰∫ëÊöóÂç¥Ê∏ÖÊô∞ÂèØËßÅ„ÄÇ",
        extra: "Light pollution ~Bortle 5; tripod + 10s exposure."
      }
    };
    const presetSel = document.getElementById('preset');
    const captionBox = document.getElementById('caption');
    const tagsUl = document.getElementById('tags');
    function renderTags(){ tagsUl.innerHTML = TAGS.map(t=>`<li>${t}</li>`).join(''); }
    function compose(p){
      const base = PRESETS[p];
      const tagStr = TAGS.slice(0,5).join(' ');
      return `${base.en}\n${base.zh}\n${base.extra}\n${tagStr}`;
    }
    function shuffle(arr){ return [...arr].sort(()=>Math.random()-0.5); }
    function update(){ captionBox.value = compose(presetSel.value); }
    document.getElementById('randomBtn').addEventListener('click',()=>{
      const mix = shuffle(TAGS).slice(0,6).join(' ');
      const p = PRESETS[presetSel.value];
      captionBox.value = `${p.en}\n${p.zh}\n${p.extra}\n${mix}`;
    });
    document.getElementById('copyBtn').addEventListener('click',async()=>{
      await navigator.clipboard.writeText(captionBox.value);
      const old = event.target.textContent; event.target.textContent='Copied!';
      setTimeout(()=>event.target.textContent=old,900);
    });
    presetSel.addEventListener('change',update);
    renderTags();
    update();
  </script>
</body>
</html>
